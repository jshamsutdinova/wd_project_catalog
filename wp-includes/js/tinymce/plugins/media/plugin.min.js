(function(){var e=(function(){'use strict';var rt=tinymce.util.Tools.resolve('tinymce.PluginManager'),d=tinymce.util.Tools.resolve('tinymce.Env'),t=tinymce.util.Tools.resolve('tinymce.util.Tools'),it=function(e){return e.getParam('media_scripts')},nt=function(e){return e.getParam('audio_template_callback')},at=function(e){return e.getParam('video_template_callback')},ot=function(e){return e.getParam('media_live_embeds',!0)},ct=function(e){return e.getParam('media_filter_html',!0)},ut=function(e){return e.getParam('media_url_resolver')},st=function(e){return e.getParam('media_alt_source',!0)},lt=function(e){return e.getParam('media_poster',!0)},mt=function(e){return e.getParam('media_dimensions',!0)},e={getScripts:it,getAudioTemplateCallback:nt,getVideoTemplateCallback:at,hasLiveEmbeds:ot,shouldFilterHtml:ct,getUrlResolver:ut,hasAltSource:st,hasPoster:lt,hasDimensions:mt};var v=function(e){var t=e,r=function(){return t},i=function(e){t=e},n=function(){return v(r())};return{get:r,set:i,clone:n}},et=function(){},n=function(e){return function(){return e}},a=n(!1),b=n(!0),m=function(){return w},w=function(){var e=function(e){return e.isNone()},t=function(e){return e()},r=function(e){return e},i={fold:function(e,t){return e()},is:a,isSome:a,isNone:b,getOr:r,getOrThunk:t,getOrDie:function(e){throw new Error(e||'error: getOrDie called on none.')},getOrNull:n(null),getOrUndefined:n(undefined),or:r,orThunk:t,map:m,each:et,bind:m,exists:a,forall:b,filter:m,equals:e,equals_:e,toArray:function(){return[]},toString:n('none()')};if(Object.freeze){Object.freeze(i)};return i}(),y=function(e){var t=n(e),o=function(){return i},r=function(t){return t(e)},i={fold:function(t,r){return r(e)},is:function(t){return e===t},isSome:b,isNone:a,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:o,orThunk:o,map:function(t){return y(t(e))},each:function(t){t(e)},bind:r,exists:r,forall:r,filter:function(t){return t(e)?i:w},toArray:function(){return[e]},toString:function(){return'some('+e+')'},equals:function(t){return t.is(e)},equals_:function(t,r){return t.fold(a,function(t){return r(e,t)})}};return i},tt=function(e){return e===null||e===undefined?w:y(e)},B={some:y,none:m,from:tt};var Be=Object.hasOwnProperty,W=function(e,t){return h(e,t)?B.from(e[t]):B.none()},h=function(e,t){return Be.call(e,t)},q=tinymce.util.Tools.resolve('tinymce.dom.DOMUtils'),p=tinymce.util.Tools.resolve('tinymce.html.SaxParser'),Ge=function(e,t){if(e){for(var r=0;r<e.length;r++){if(t.indexOf(e[r].filter)!==-1){return e[r]}}}},g={getVideoScriptMatch:Ge};var Je=q.DOM,J=function(e){return e.replace(/px$/,'')},We=function(e){var t=e.map.style,r=t?Je.parseStyle(t):{};return{type:'ephox-embed-iri',source1:e.map['data-ephox-embed-iri'],source2:'',poster:'',width:W(r,'max-width').map(J).getOr(''),height:W(r,'max-height').map(J).getOr('')}},qe=function(e,r){var n=v(!1),i={};p({validate:!1,allow_conditional_comments:!0,special:'script,noscript',start:function(r,a){if(n.get());else if(h(a.map,'data-ephox-embed-iri')){n.set(!0);i=We(a)}
else{if(!i.source1&&r==='param'){i.source1=a.map.movie};if(r==='iframe'||r==='object'||r==='embed'||r==='video'||r==='audio'){if(!i.type){i.type=r};i=t.extend(a.map,i)};if(r==='script'){var o=g.getVideoScriptMatch(e,a.map.src);if(!o){return};i={type:'script',source1:a.map.src,width:o.width,height:o.height}};if(r==='source'){if(!i.source1){i.source1=a.map.src}
else if(!i.source2){i.source2=a.map.src}};if(r==='img'&&!i.poster){i.poster=a.map.src}}}}).parse(r);i.source1=i.source1||i.src||i.data;i.source2=i.source2||'';i.poster=i.poster||'';return i},l={htmlToData:qe};var R=tinymce.util.Tools.resolve('tinymce.util.Promise'),Ie=function(e){var i={mp3:'audio/mpeg',wav:'audio/wav',mp4:'video/mp4',webm:'video/webm',ogg:'video/ogg',};var r=e.toLowerCase().split('.').pop(),t=i[r];return t?t:''},I={guess:Ie};var E=tinymce.util.Tools.resolve('tinymce.html.Schema'),L=tinymce.util.Tools.resolve('tinymce.html.Writer'),U=q.DOM,V=function(e){return/^[0-9.]+$/.test(e)?e+'px':e},r=function(e,t){for(var r in t){var i=''+t[r];if(e.map[r]){var n=e.length;while(n--){var a=e[n];if(a.name===r){if(i){e.map[r]=i;a.value=i}
else{delete e.map[r];e.splice(n,1)}}}}
else if(i){e.push({name:r,value:i});e.map[r]=i}}},Ve=function(e,t){var n=t.map.style,i=n?U.parseStyle(n):{};i['max-width']=V(e.width);i['max-height']=V(e.height);r(t,{style:U.serializeStyle(i)})},Re=function(e,t,i){var n=L(),o=v(!1),a=0,c;p({validate:!1,allow_conditional_comments:!0,special:'script,noscript',comment:function(e){n.comment(e)},cdata:function(e){n.cdata(e)},text:function(e,t){n.text(e,t)},start:function(e,u,s){if(o.get());else if(h(u.map,'data-ephox-embed-iri')){o.set(!0);Ve(t,u)}
else{switch(e){case'video':case'object':case'embed':case'img':case'iframe':if(t.height!==undefined&&t.width!==undefined){r(u,{width:t.width,height:t.height})};break};if(i){switch(e){case'video':r(u,{poster:t.poster,src:''});if(t.source2){r(u,{src:''})};break;case'iframe':r(u,{src:t.source1});break;case'source':a++;if(a<=2){r(u,{src:t['source'+a],type:t['source'+a+'mime']});if(!t['source'+a]){return}};break;case'img':if(!t.poster){return};c=!0;break}}};n.start(e,u,s)},end:function(e){if(!o.get()){if(e==='video'&&i){for(var u=1;u<=2;u++){if(t['source'+u]){var l=[];l.map={};if(a<u){r(l,{src:t['source'+u],type:t['source'+u+'mime']});n.start('source',l,!0)}}}};if(t.poster&&e==='object'&&i&&!c){var s=[];s.map={};r(s,{src:t.poster,width:t.width,height:t.height});n.start('img',s,!0)}};n.end(e)}},E({})).parse(e);return n.getContent()},s={updateHtml:Re};var Ue=[{regex:/youtu\.be\/([\w\-_\?&=.]+)/i,type:'iframe',w:560,h:314,url:'//www.youtube.com/embed/$1',allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:'iframe',w:560,h:314,url:'//www.youtube.com/embed/$2?$4',allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\?&=\-_]+)/i,type:'iframe',w:560,h:314,url:'//www.youtube.com/embed/$1',allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:'iframe',w:425,h:350,url:'//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc',allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:'iframe',w:425,h:350,url:'//player.vimeo.com/video/$2?title=0&amp;byline=0',allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:'iframe',w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:'iframe',w:480,h:270,url:'//www.dailymotion.com/embed/video/$1',allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:'iframe',w:480,h:270,url:'//www.dailymotion.com/embed/video/$1',allowFullscreen:!0}];var Ne=function(e,t){var i=e.regex.exec(t),n=e.url,a=function(e){n=n.replace('$'+e,function(){return i[e]?i[e]:''})};for(var r=0;r<i.length;r++){a(r)};return n.replace(/\?$/,'')},Ae=function(e){var r=Ue.filter(function(t){return t.regex.test(e)});if(r.length>0){return t.extend({},r[0],{url:Ne(r[0],e)})}
else{return null}},He=function(e){var t=e.allowFullscreen?' allowFullscreen="1"':'';return'<iframe src="'+e.source1+'" width="'+e.width+'" height="'+e.height+'"'+t+'></iframe>'},Pe=function(e,t){if(t){return t(e)}
else{return'<audio controls="controls" src="'+e.source1+'">'+(e.source2?'\n<source src="'+e.source2+'"'+(e.source2mime?' type="'+e.source2mime+'"':'')+' />\n':'')+'</audio>'}},De=function(e,t){if(t){return t(e)}
else{return'<video width="'+e.width+'" height="'+e.height+'"'+(e.poster?' poster="'+e.poster+'"':'')+' controls="controls">\n<source src="'+e.source1+'"'+(e.source1mime?' type="'+e.source1mime+'"':'')+' />\n'+(e.source2?'<source src="'+e.source2+'"'+(e.source2mime?' type="'+e.source2mime+'"':'')+' />\n':'')+'</video>'}},Fe=function(e){return'<script src="'+e.source1+'"></script>'},Ee=function(r,n){var i=t.extend({},n);if(!i.source1){t.extend(i,l.htmlToData(e.getScripts(r),i.embed));if(!i.source1){return''}};if(!i.source2){i.source2=''};if(!i.poster){i.poster=''};i.source1=r.convertURL(i.source1,'source');i.source2=r.convertURL(i.source2,'source');i.source1mime=I.guess(i.source1);i.source2mime=I.guess(i.source2);i.poster=r.convertURL(i.poster,'poster');var a=Ae(i.source1);if(a){i.source1=a.url;i.type=a.type;i.allowFullscreen=a.allowFullscreen;i.width=i.width||a.w;i.height=i.height||a.h};if(i.embed){return s.updateHtml(i.embed,i,!0)}
else{var o=g.getVideoScriptMatch(e.getScripts(r),i.source1);if(o){i.type='script';i.width=o.width;i.height=o.height};var c=e.getAudioTemplateCallback(r),u=e.getVideoTemplateCallback(r);i.width=i.width||300;i.height=i.height||150;t.each(i,function(e,t){i[t]=r.dom.encode(e)});if(i.type==='iframe'){return He(i)}
else if(i.source1mime.indexOf('audio')!==-1){return Pe(i,c)}
else if(i.type==='script'){return Fe(i)}
else{return De(i,u)}}},Le={dataToHtml:Ee};var u={};var Ce=function(e,t,r){return new R(function(i,n){var a=function(r){if(r.html){u[e.source1]=r};return i({url:e.source1,html:r.html?r.html:t(e)})};if(u[e.source1]){a(u[e.source1])}
else{r({url:e.source1},a,n)}})},Me=function(e,t){return new R(function(r){r({html:t(e),url:e.source1})})},F=function(e){return function(t){return Le.dataToHtml(e,t)}},ke=function(t,r){var i=e.getUrlResolver(t);return i?Ce(r,F(t),i):Me(r,F(t))},ze=function(e){return u.hasOwnProperty(e)},c={getEmbedHtml:ke,isCached:ze};var je=function(e){return e.replace(/px$/,'')},Te=function(e){return/^[0-9.]+$/.test(e)?e+'px':e},H=function(e){return function(t){return t?je(t.style[e]):''}},P=function(e){return function(t,r){if(t){t.style[e]=Te(r)}}},D={getMaxWidth:H('maxWidth'),getMaxHeight:H('maxHeight'),setMaxWidth:P('maxWidth'),setMaxHeight:P('maxHeight')};var z=function(e,t){e.state.set('oldVal',e.value());t.state.set('oldVal',t.value())},N=function(e,t){var r=e.find('#width')[0],i=e.find('#height')[0],n=e.find('#constrain')[0];if(r&&i&&n){t(r,i,n.checked())}},xe=function(e,t,i){var a=e.state.get('oldVal'),o=t.state.get('oldVal'),r=e.value(),n=t.value();if(i&&a&&o&&r&&n){if(r!==a){n=Math.round(r/a*n);if(!isNaN(n)){t.value(n)}}
else{r=Math.round(n/o*r);if(!isNaN(r)){e.value(r)}}};z(e,t)},Se=function(e){N(e,z)},A=function(e){N(e,xe)},Oe=function(e){var t=function(){e(function(e){A(e)})};return{type:'container',label:'Dimensions',layout:'flex',align:'center',spacing:5,items:[{name:'width',type:'textbox',maxLength:5,size:5,onchange:t,ariaLabel:'Width'},{type:'label',text:'x'},{name:'height',type:'textbox',maxLength:5,size:5,onchange:t,ariaLabel:'Height'},{name:'constrain',type:'checkbox',checked:!0,text:'Constrain proportions'}]}},o={createUi:Oe,syncSize:Se,updateSize:A};var he=d.ie&&d.ie<=8?'onChange':'onInput',f=function(e){return function(t){var r=t&&t.msg?'Media embed handler error: '+t.msg:'Media embed handler threw unknown error.';e.notificationManager.open({type:'error',text:r})}},pe=function(t){var r=t.selection.getNode(),i=r.getAttribute('data-ephox-embed-iri');if(i){return{'source1':i,'data-ephox-embed-iri':i,'width':D.getMaxWidth(r),'height':D.getMaxHeight(r)}};return r.getAttribute('data-mce-object')?l.htmlToData(e.getScripts(t),t.serializer.serialize(r,{selection:!0})):{}},ge=function(e){var t=e.selection.getNode();if(t.getAttribute('data-mce-object')||t.getAttribute('data-ephox-embed-iri')){return e.selection.getContent()}},C=function(r,i){return function(n){var a=n.html,c=r.find('#embed')[0],u=t.extend(l.htmlToData(e.getScripts(i),a),{source1:n.url});r.fromJSON(u);if(c){c.value(a);o.updateSize(r)}}},ve=function(e,t){var i,r,n=e.dom.select('img[data-mce-object]');for(i=0;i<t.length;i++){for(r=n.length-1;r>=0;r--){if(t[i]===n[r]){n.splice(r,1)}}};e.selection.select(n[0])},M=function(e,t){var r=e.dom.select('img[data-mce-object]');e.insertContent(t);ve(e,r);e.nodeChanged()},be=function(e,t){var r=e.toJSON();r.embed=s.updateHtml(r.embed,r);if(r.embed&&c.isCached(r.source1)){M(t,r.embed)}
else{c.getEmbedHtml(t,r).then(function(e){M(t,e.html)}).catch(f(t))}},we=function(e,r){t.each(r,function(t,r){e.find('#'+r).value(t)})},ye=function(r){var i,n,d=[{name:'source1',type:'filepicker',filetype:'media',size:40,autofocus:!0,label:'Source',onpaste:function(){setTimeout(function(){c.getEmbedHtml(r,i.toJSON()).then(C(i,r)).catch(f(r))},1)},onchange:function(e){c.getEmbedHtml(r,i.toJSON()).then(C(i,r)).catch(f(r));we(i,e.meta)},onbeforecall:function(e){e.meta=i.toJSON()}}];var a=[],g=function(e){e(i);n=i.toJSON();i.find('#embed').value(s.updateHtml(n.embed,n))};if(e.hasAltSource(r)){a.push({name:'source2',type:'filepicker',filetype:'media',size:40,label:'Alternative source'})};if(e.hasPoster(r)){a.push({name:'poster',type:'filepicker',filetype:'image',size:40,label:'Poster'})};if(e.hasDimensions(r)){var p=o.createUi(g);d.push(p)};n=pe(r);var m={id:'mcemediasource',type:'textbox',flex:1,name:'embed',value:ge(r),multiline:!0,rows:5,label:'Source'};var h=function(){n=t.extend({},l.htmlToData(e.getScripts(r),this.value()));this.parent().parent().fromJSON(n)};m[he]=h;var u=[{title:'General',type:'form',items:d},{title:'Embed',type:'container',layout:'flex',direction:'column',align:'stretch',padding:10,spacing:10,items:[{type:'label',text:'Paste your embed code below:',forId:'mcemediasource'},m]}];if(a.length>0){u.push({title:'Advanced',type:'form',items:a})};i=r.windowManager.open({title:'Insert/edit media',data:n,bodyType:'tabpanel',body:u,onSubmit:function(){o.updateSize(i);be(i,r)}});o.syncSize(i)},k={showDialog:ye};var de=function(e){var t=function(){k.showDialog(e)};return{showDialog:t}},fe={get:de};var le=function(e){var t=function(){k.showDialog(e)};e.addCommand('mceMedia',t)},me={register:le};var i=tinymce.util.Tools.resolve('tinymce.html.Node'),se=function(t,r){if(e.shouldFilterHtml(t)===!1){return r};var i=L(),n;p({validate:!1,allow_conditional_comments:!1,special:'script,noscript',comment:function(e){i.comment(e)},cdata:function(e){i.cdata(e)},text:function(e,t){i.text(e,t)},start:function(e,r,a){n=!0;if(e==='script'||e==='noscript'||e==='svg'){return};for(var o=r.length-1;o>=0;o--){var c=r[o].name;if(c.indexOf('on')===0){delete r.map[c];r.splice(o,1)};if(c==='style'){r[o].value=t.dom.serializeStyle(t.dom.parseStyle(r[o].value),e)}};i.start(e,r,a);n=!1},end:function(e){if(n){return};i.end(e)}},E({})).parse(r);return i.getContent()},T={sanitize:se};var x=function(e,t){var r,n=t.name;r=new i('img',1);r.shortEnded=!0;O(e,t,r);r.attr({'width':t.attr('width')||'300','height':t.attr('height')||(n==='audio'?'30':'150'),'style':t.attr('style'),'src':d.transparentSrc,'data-mce-object':n,'class':'mce-object mce-object-'+n});return r},S=function(e,t){var r,n,a,o=t.name;r=new i('span',1);r.attr({'contentEditable':'false','style':t.attr('style'),'data-mce-object':o,'class':'mce-preview-object mce-object-'+o});O(e,t,r);n=new i(o,1);n.attr({src:t.attr('src'),allowfullscreen:t.attr('allowfullscreen'),style:t.attr('style'),class:t.attr('class'),width:t.attr('width'),height:t.attr('height'),frameborder:'0'});a=new i('span',1);a.attr('class','mce-shim');r.append(n);r.append(a);return r},O=function(e,t,r){var i,n,a,o,c;a=t.attributes;o=a.length;while(o--){i=a[o].name;n=a[o].value;if(i!=='width'&&i!=='height'&&i!=='style'){if(i==='data'||i==='src'){n=e.convertURL(n,i)};r.attr('data-mce-p-'+i,n)}};c=t.firstChild&&t.firstChild.value;if(c){r.attr('data-mce-html',escape(T.sanitize(e,c)));r.firstChild=null}},j=function(e){while(e=e.parent){if(e.attr('data-ephox-embed-iri')){return!0}};return!1},ce=function(t){return function(r){var a=r.length,i,n;while(a--){i=r[a];if(!i.parent){continue};if(i.parent.attr('data-mce-object')){continue};if(i.name==='script'){n=g.getVideoScriptMatch(e.getScripts(t),i.attr('src'));if(!n){continue}};if(n){if(n.width){i.attr('width',n.width.toString())};if(n.height){i.attr('height',n.height.toString())}};if(i.name==='iframe'&&e.hasLiveEmbeds(t)&&d.ceFalse){if(!j(i)){i.replace(S(t,i))}}
else{if(!j(i)){i.replace(x(t,i))}}}}},ue={createPreviewIframeNode:S,createPlaceholderNode:x,placeHolderConverter:ce};var ae=function(e){e.on('preInit',function(){var n=e.schema.getSpecialElements();t.each('video audio iframe object'.split(' '),function(e){n[e]=new RegExp('</'+e+'[^>]*>','gi')});var r=e.schema.getBoolAttrs();t.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '),function(e){r[e]={}});e.parser.addNodeFilter('iframe,video,audio,object,embed,script',ue.placeHolderConverter(e));e.serializer.addAttributeFilter('data-mce-object',function(t,r){var f=t.length,n,a,c,u,l,s,o,m;while(f--){n=t[f];if(!n.parent){continue};o=n.attr(r);a=new i(o,1);if(o!=='audio'&&o!=='script'){m=n.attr('class');if(m&&m.indexOf('mce-preview-object')!==-1){a.attr({width:n.firstChild.attr('width'),height:n.firstChild.attr('height')})}
else{a.attr({width:n.attr('width'),height:n.attr('height')})}};a.attr({style:n.attr('style')});u=n.attributes;c=u.length;while(c--){var d=u[c].name;if(d.indexOf('data-mce-p-')===0){a.attr(d.substr(11),u[c].value)}};if(o==='script'){a.attr('type','text/javascript')};l=n.attr('data-mce-html');if(l){s=new i('#text',3);s.raw=!0;s.value=T.sanitize(e,unescape(l));a.append(s)};n.replace(a)}})});e.on('setContent',function(){e.$('span.mce-preview-object').each(function(t,r){var i=e.$(r);if(i.find('span.mce-shim',r).length===0){i.append('<span class="mce-shim"></span>')}})})},oe={setup:ae};var ie=function(e){e.on('ResolveName',function(e){var t;if(e.target.nodeType===1&&(t=e.target.getAttribute('data-mce-object'))){e.name=t}})},ne={setup:ie};var te=function(e){e.on('click keyup',function(){var t=e.selection.getNode();if(t&&e.dom.hasClass(t,'mce-preview-object')){if(e.dom.getAttrib(t,'data-mce-selected')){t.setAttribute('data-mce-selected','2')}}});e.on('ObjectSelected',function(e){var t=e.target.getAttribute('data-mce-object');if(t==='audio'||t==='script'){e.preventDefault()}});e.on('objectResized',function(e){var r=e.target,t;if(r.getAttribute('data-mce-object')){t=r.getAttribute('data-mce-html');if(t){t=unescape(t);r.setAttribute('data-mce-html',escape(s.updateHtml(t,{width:e.width,height:e.height})))}}})},re={setup:te};var G=function(e){e.addButton('media',{tooltip:'Insert/edit media',cmd:'mceMedia',stateSelector:['img[data-mce-object]','span[data-mce-object]','div[data-ephox-embed-iri]']});e.addMenuItem('media',{icon:'media',text:'Media',cmd:'mceMedia',context:'insert',prependToContext:!0})},ee={register:G};rt.add('media',function(e){me.register(e);ee.register(e);ne.setup(e);oe.setup(e);re.setup(e);return fe.get(e)});function dt(){};return dt}())})();